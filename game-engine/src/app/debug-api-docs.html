<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aquarium Autobattler - Debug API Documentation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        h2 {
            color: #3b82f6;
            margin-top: 30px;
        }
        .endpoint {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
            margin-right: 10px;
        }
        .get { background: #28a745; color: white; }
        .post { background: #ffc107; color: black; }
        .url {
            font-family: 'Courier New', monospace;
            color: #495057;
            font-size: 14px;
        }
        .description {
            margin: 10px 0;
            color: #666;
        }
        .example {
            background: #263238;
            color: #aed581;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê† Aquarium Autobattler - Debug API Documentation</h1>
        
        <p>These endpoints are for debugging and testing purposes. They provide access to game session data and management tools.</p>
        
        <h2>Session Management Endpoints</h2>
        
        <div class="endpoint">
            <div>
                <span class="method get">GET</span>
                <span class="url">/api/debug/sessions</span>
            </div>
            <div class="description">
                Get a summary of all active game sessions. Shows player IDs, current game state, and draft save status.
            </div>
            <div class="example">
<pre>curl http://localhost:3001/api/debug/sessions

Response:
[
  {
    "playerId": "player-abc123",
    "socketIds": ["socket-123"],
    "gold": 10,
    "round": 1,
    "pieces": 2,
    "hasDraftState": true,
    "draftStateLastModified": "2025-01-01T00:00:00.000Z"
  }
]</pre>
            </div>
        </div>
        
        <div class="endpoint">
            <div>
                <span class="method get">GET</span>
                <span class="url">/api/debug/session/:playerId</span>
            </div>
            <div class="description">
                Get detailed information about a specific player's session, including full game state and draft state.
            </div>
            <div class="example">
<pre>curl http://localhost:3001/api/debug/session/player-abc123

Response:
{
  "sessionId": "player-abc123",
  "gameState": {
    "phase": "shop",
    "round": 1,
    "gold": 10,
    "playerTank": { ... },
    "shop": [ ... ],
    // ... complete game state
  },
  "draftState": {
    "gold": 10,
    "round": 1,
    "pieces": 2,
    "lastModified": "2025-01-01T00:00:00.000Z",
    "fullDraftState": { ... }
  }
}</pre>
            </div>
        </div>
        
        <div class="endpoint">
            <div>
                <span class="method post">POST</span>
                <span class="url">/api/debug/clear-all-sessions</span>
            </div>
            <div class="description">
                Clear all game sessions from memory. Useful for testing fresh starts.
            </div>
            <div class="warning">
                ‚ö†Ô∏è WARNING: This will delete ALL active game sessions and cannot be undone!
            </div>
            <div class="example">
<pre>curl -X POST http://localhost:3001/api/debug/clear-all-sessions

Response:
{
  "message": "Cleared 5 sessions",
  "clearedCount": 5,
  "socketMappingsCleared": 3
}</pre>
            </div>
        </div>
        
        <h2>How Sessions Work</h2>
        
        <p>The game uses a persistent player ID system:</p>
        <ul>
            <li><strong>Player ID</strong>: Stored in browser localStorage (e.g., "player-abc123")</li>
            <li><strong>Socket ID</strong>: WebSocket connection ID, changes on each connection</li>
            <li><strong>Session Persistence</strong>: Game state is tied to Player ID, survives page refreshes</li>
            <li><strong>Draft State</strong>: Saved game state that can be restored after disconnection</li>
        </ul>
        
        <h2>Quick Actions</h2>
        
        <p>
            <a href="http://localhost:3001/api/debug/sessions" target="_blank">
                View All Sessions ‚Üí
            </a>
        </p>
        
        <p>
            <button onclick="clearSessions()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                Clear All Sessions
            </button>
        </p>
        
        <script>
            async function clearSessions() {
                if (confirm('Are you sure you want to clear all sessions? This cannot be undone.')) {
                    try {
                        const response = await fetch('http://localhost:3001/api/debug/clear-all-sessions', {
                            method: 'POST'
                        });
                        const data = await response.json();
                        alert(`Success: ${data.message}`);
                    } catch (error) {
                        alert(`Error: ${error.message}`);
                    }
                }
            }
        </script>
    </div>
</body>
</html>